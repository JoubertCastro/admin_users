<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Painel de Administra√ß√£o</title>
  <style>
    :root {
      --primary: #007bff;
      --primary-dark: #0056b3;
      --danger: #dc3545;
      --gray: #6c757d;
      --bg: #f4f6f8;
      --card: #ffffff;
      --text: #333;
    }

    body {
      font-family: Arial, sans-serif;
      background: var(--bg);
      margin: 0;
      padding: 30px;
    }

    h1, h2 {
      color: var(--text);
      margin-bottom: 15px;
    }

    /* Container centralizado */
    .container {
      max-width: 900px;
      margin: auto;
    }

    /* Formul√°rio */
    form {
      background: var(--card);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }

    form h2 {
      margin-top: 0;
      margin-bottom: 15px;
    }

    label {
      font-size: 14px;
      font-weight: bold;
      display: block;
      margin-bottom: 5px;
      color: #555;
    }

    input, button {
      width: 100%;
      margin-bottom: 15px;
      padding: 12px;
      font-size: 15px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    input:focus {
      border-color: var(--primary);
      outline: none;
      box-shadow: 0 0 3px rgba(0,123,255,0.4);
    }

    button {
      background: var(--primary);
      color: white;
      border: none;
      cursor: pointer;
      transition: background 0.3s;
      font-weight: bold;
      border-radius: 6px;
    }

    button:hover {
      background: var(--primary-dark);
    }

    /* Lista de usu√°rios */
    .usuarios {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 15px;
    }

    .usuario-card {
      background: var(--card);
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .usuario-card strong {
      font-size: 16px;
      color: var(--text);
    }

    .usuario-card small {
      color: #666;
      display: block;
      margin-top: 4px;
    }

    .status {
      margin-top: 5px;
      font-weight: bold;
    }

    .status.ativo {
      color: green;
    }

    .status.inativo {
      color: red;
    }

    .actions {
      margin-top: 12px;
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      flex-wrap: wrap;
    }

    .actions button {
      flex: 1;
      padding: 8px;
      font-size: 14px;
      border-radius: 6px;
    }

    .actions .edit {
      background: var(--gray);
    }

    .actions .delete {
      background: var(--danger);
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Administra√ß√£o de Usu√°rios</h1>

    <form id="userForm">
      <h2>Novo / Editar Usu√°rio</h2>
      <input type="hidden" id="id" />

      <label for="nome">Nome</label>
      <input type="text" id="nome" placeholder="Nome completo" required />

      <label for="email">Email</label>
      <input type="email" id="email" placeholder="exemplo@email.com" required />

      <label for="senha">Senha</label>
      <input type="password" id="senha" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required />

      <label>
        <input type="checkbox" id="ativo" checked />
        Usu√°rio ativo
      </label>

      <button type="submit">üíæ Salvar Usu√°rio</button>
    </form>

    <h2>Usu√°rios Cadastrados</h2>
    <div class="usuarios" id="listaUsuarios"></div>
  </div>

  <script>
    const API_BASE = "https://whatsapp-webhook-production-9a27.up.railway.app";
    const form = document.getElementById('userForm');
    const lista = document.getElementById('listaUsuarios');

    async function carregarUsuarios() {
      const res = await fetch(`${API_BASE}/api/usuarios`);
      const usuarios = await res.json();
      lista.innerHTML = '';

      usuarios.forEach(u => {
        const criado = new Date(u.criado_em).toLocaleString('pt-BR');
        const statusClass = u.ativo ? 'ativo' : 'inativo';
        const statusText = u.ativo ? '‚úÖ Ativo' : '‚ùå Inativo';

        const card = document.createElement('div');
        card.className = 'usuario-card';
        card.innerHTML = `
          <div>
            <strong>${u.nome}</strong>
            <small>${u.email}</small>
            <small>Criado em: ${criado}</small>
            <div class="status ${statusClass}">${statusText}</div>
          </div>
          <div class="actions">
            <button class="edit" onclick="editar(${u.id}, '${u.nome}', '${u.email}', ${u.ativo})">‚úèÔ∏è Editar</button>
            ${u.ativo
              ? `<button class="delete" onclick="excluir(${u.id})">üö´ Desativar</button>`
              : `<button onclick="reativar(${u.id})">‚úÖ Reativar</button>`
            }
          </div>
        `;
        lista.appendChild(card);
      });
    }

    form.onsubmit = async (e) => {
      e.preventDefault();
      const id = document.getElementById('id').value;
      const nome = document.getElementById('nome').value;
      const email = document.getElementById('email').value;
      const senha = document.getElementById('senha').value;
      const ativo = document.getElementById('ativo').checked;

      const metodo = id ? 'PUT' : 'POST';
      const url = id ? `${API_BASE}/api/usuarios/${id}` : `${API_BASE}/api/cadastrar`;

      const res = await fetch(url, {
        method: metodo,
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ nome, email, senha, ativo })
      });

      const resultado = await res.json();
      if (!resultado.ok) {
        alert(resultado.erro || 'Erro ao salvar usu√°rio');
        return;
      }

      form.reset();
      document.getElementById('ativo').checked = true;
      document.getElementById('id').value = '';
      carregarUsuarios();
    };

    function editar(id, nome, email, ativo) {
      document.getElementById('id').value = id;
      document.getElementById('nome').value = nome;
      document.getElementById('email').value = email;
      document.getElementById('senha').value = '';
      document.getElementById('ativo').checked = ativo;
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    async function excluir(id) {
      if (!confirm('Desativar este usu√°rio?')) return;
      await fetch(`${API_BASE}/api/usuarios/${id}`, { method: 'DELETE' });
      carregarUsuarios();
    }

    async function reativar(id) {
      await fetch(`${API_BASE}/api/usuarios/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          nome: 'temp', email: 'temp@temp.com', senha: 'temp', ativo: true
        })
      });
      carregarUsuarios();
    }

    carregarUsuarios();
  </script>
</body>
</html>
